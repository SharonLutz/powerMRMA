# powerMRMA
Power package to examine the mediated path from gene to outcome through an intermediate phenotype. This R package compares Mendelian Randomization (MR) and mediation analysis approaches to detect the path from the mediator to the outcome given at least one SNP serves as an instrumental variable for the mediator.

#### Installation
```
install.packages("devtools") # devtools must be installed first
install.packages("mediation")
install.packages("MendelianRandomization")

devtools::install_github("SharonLutz/powerMRMA")
```

#### Input
nSNP is the number of SNPs generated from a binomial distribution for n subjects (input n) for a given minor allele frequency (input vector MAF).

For the SNPs Xi and unmeasured confounder U, the mediator M is generated from a normal distirbution with variance (input varM) and mean
E\[M\] = \gamma0 + sum \gammaX * Xi + \gammaU * U

All of these values are inputted by the user (i.e. the intercept gamma0, the genetic effect size as a vector gammaX, and the effect of the unmeasured confouder U as gammU).

The intercept is inputted\gamma0 is set using "gamma0" (default = 0), \gammaX is set using "gammaX" and indicates the association of each SNP Xi with the mediator M. \gammaX must be input as a vector with length equal to nSNP, the default is \gammaX = c(0.15,0.15,0.15,0.15). The user can set \gamma_X to 0 for any SNPS that is not an instrumental variable of M. \gammaU is set with "gammaU" (default = 0), and indicates the level of unmeasured confounding to generate.

The variance of M is set with varM (default = 1). 

Y is generated such that E\[Y\] = ....

\beta0 is set with "beta0" (default = 0), \betaX is set with "betaX" and indicates the direct effect from each SNP Xi to the outcome Y. \betaX must be a vector of length equal to nSNP, the default is \betaX = c(0,0,0,0). \betaU is set with "betaU" (default = 0), and indicates the level of unmeasured confounding to generate. The association of M with Y is set using "betaM". \betaM must be a vector of length >= 2 and will be the x-axis of the power plot. 

The variance of Y is set with varY (default = 1).

U is generated such that U = rnorm(\muU,\varU) where the mean can be set with muU (default = 0) and the variance can be set with varU (default = 1).

An interaction between a SNP_i and M on Y can be generated by setting index i of "betaI" to be nonzero. \betaI must be a vector of length equal to nSNP, the default is no interaction \betaI = c(0,0,0,0).

Measurement error is generated such that M* = M + rnorm(\muME,\varME), and M* is used in analysis. \muME is set using "muME" (default = 0) and varME is set using "varME" (default = 1). Measurement error can be generated or not generated using "MeasurementError". TRUE indicates measurement error is generated while FALSE indicates no measurement error of the mediator is generated.

The plot name can be chosen by the user with "plot.name", the default is "powerMRMAplot". Additionally, the user can choose whether or not to include a legend with "legend.include", and can choose to have a color or grayscale plot with "legend.color".

The sample size is set using "n" (default = 1000). The number of simulations to run is set by "n.sim" (default = 500). Users should note that this function is slow.

The seed is set with "seed" (default = 1).

The default alpha level is 0.05 and can be changed by setting "alpha.level". The mediation analysis and MR Classical methods  are evaluated using an alpha level of alpha.level/nSNP while the MR Egger, MR IVW and MR Median methods are evaluated using alpha.level.

MethodNames denotes the possible methods used. (i.e. MethodNames= c("MR.Classical", "MR.Egger", "MR.IVW", "MR.Median", "MA.Imai", "MA.4Way")) where 

MR.Classical is the classical approach to MR.
Davey Smith, G., & Hemani, G. (2014). Mendelian randomization: genetic anchors for causal inference in epidemiological studies. Human Molecular Genetics, 23(R1), 89-98. 

MR.Egger is the Egger Regression approach to MR.
Bowden J., Davey Smith G., & Burgess S. (2015). Mendelian Randomization with invalid instruments: effect estimation and bias detection through Egger regression. International Journal of Epidemiology, 44(2), 512-525. 

MR.IVW is the Inverse Variant Weighted approach to MR.
Burgess, S., Butterworth, A., & Thompson, S. G. (2013). Mendelian Randomization Analysis With Multiple Genetic Variants Using Summarized Data. Genetic Epidemiology, 37(7), 658-665.

MR. Median is the Median Weighted approach to MR.
Bowden, J., Davey Smith, G., Haycock, P. C., & Burgess, S. (2016). Consistent Estimation in Mendelian Randomization with Some Invalid Instruments Using a Weighted Median Estimator. Genetic Epidemiology, 40(4), 304-314. 

MA.Imai is the Imai et al. approach to mediation analysis.
Imai, K., Keele, L., & Tingley, D. (2010). A general approach to causal mediation analysis. Psychological methods, 15(4), 309-334.

MA.4way is the 4 way decompoisition to mediation analysis.
VanderWeele, T. J. (2014). A unification of mediation and interaction: a four-way decomposition. Epidemiology (Cambridge, Mass.), 25(5), 749-761. 

Please use ?powerMRMA to see the man page which gives full details for all of the input parameters.

#### Example
This example displays the power of all six methods, using four SNPs as instrumental variables, each with a MAF of 0.2. Two levels of association between M and Y are evaluated, 0.15 and 0.25. There is no measurement error of the mediator or unmeasured confounding of the mediator outcome generated. There is no direct effect from any SNP X to the outcome Y or interaction between any X and M on Y generated. This code runs 100 simulations of a sample size of 1000.
```
library(powerMRMA)
?powerMRMA # For details on this function

powerMRMA (plot.name = "powerMRMAplot",methodnames = c("MR.Classical","MR.Egger","MR.IVW","MR.Median","MA.Imai","MA.4Way")
,n = 1000,n.sim=100,MeasurementError=F, nSNP = 4, MAF=c(0.2,0.2,0.2,0.2), gammaX = c(.15,.15,.15,.15), betaM = c(0, 0.2, 0.25))

```

#### Output
For this example analysis, we get the following matrix of the power of each method to detect an indirect effect, and corresponding plot:

```
     MR.Classical MR.Egger MR.IVW MR.Median MA.Imai MA.4Way
[1,]         0.00     0.00   0.00      0.00     0.0     0.0
[2,]         0.01     0.05   0.26      0.06     0.5     0.4
[1] "The plot is saved in your home directory."
```
<img src="https://github.com/SharonLutz/powerMRMA/blob/master/powerMRMAplot.png" width="600">

#### Reference
Thwing A, Ghosh D, Hokanson JE, Lutz SM. (2018) Mediated Paths in Genetic Association Studies: A Comparison of Mendelian Randomization and Mediation Analysis Approaches. (Target Journal).

